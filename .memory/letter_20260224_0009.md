# Letter to Myself (Session Handoff)

**Date:** 2026-02-24

## 1. Executive Summary
* **Goal:** Fix auth 404 and missing footer on production, migrate middleware to proxy for Next.js 16.
* **Current Status:** Root cause found and fixed — auth route was in wrong directory. Committed and pushed, awaiting Vercel deploy.

## 2. The "Done" List (Context Anchor)
* Discovered auth route was at `src/apps/web/app/api/auth/[...nextauth]/route.ts` — NOT served by Next.js (which uses `src/app/`)
* Created `src/app/api/auth/[...nextauth]/route.ts` with identical content — `/api/auth/*` now appears in build output
* Migrated `src/middleware.ts` → `src/proxy.ts` with function rename `middleware` → `proxy` for Next.js 16 compatibility
* Verified build succeeds with all routes listed including `ƒ /api/auth/[...nextauth]`
* Committed as `4bd4cd0` and pushed to main

## 3. The "Pain" Log (CRITICAL)
* **Tried:** Magic link auth on production — got 404
* **Failed:** NextAuth route was only at `src/apps/web/app/api/auth/` (legacy DDD structure), not at `src/app/api/auth/` (where Next.js App Router serves routes)
* **Workaround:** Created the auth route in the correct `src/app/api/auth/[...nextauth]/` directory. The `src/apps/web/` version is now effectively dead code.
* **Tried:** `middleware.ts` — Next.js 16 shows deprecation warning "use proxy instead"
* **Workaround:** Renamed file to `proxy.ts`, renamed exported function from `middleware` to `proxy`. Config stays the same.
* **Note:** Resend limitation still applies — `onboarding@resend.dev` sender only delivers to `oliver.baer@gmail.com` until domain `nyxcore.cloud` DNS is verified.

## 4. Active Variable State
* `RESEND_API_KEY` set on Vercel production
* `NEXTAUTH_SECRET` set on Vercel production
* Default sender: `onboarding@resend.dev` — only delivers to Resend account owner's email
* `src/apps/web/app/api/auth/[...nextauth]/route.ts` is now dead code (duplicate of `src/app/api/auth/`)
* Next.js 16 uses `proxy.ts` convention instead of `middleware.ts`

## 5. Immediate Next Steps
1. [ ] Verify Vercel deployment succeeds and magic link works with oliver.baer@gmail.com
2. [ ] Verify footer appears on production (was in previous commit, may need deploy to propagate)
3. [ ] Clean up dead code at `src/apps/web/` (auth route is duplicated)
4. [ ] Verify domain `nyxcore.cloud` DNS records on Resend for unrestricted email delivery
