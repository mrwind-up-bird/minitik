# Letter to Myself (Session Handoff)

**Date:** 2026-02-24

## 1. Executive Summary
* **Goal:** Wire up the Next.js app shell — root layout, auth middleware, 7 app pages, PWA manifest, and missing API routes — connecting all 9 existing React components and 16 API routes.
* **Current Status:** All 15 files created/modified, `tsc --noEmit` passes with zero errors, `npm run build` succeeds (23 routes: 7 static pages + 16 dynamic API routes). Ready to commit.

## 2. The "Done" List (Context Anchor)
* Created `src/middleware.ts` — JWT extraction via `getToken()`, injects `x-user-id` header for API routes, redirects unauthenticated page requests to `/login`
* Created `src/app/providers.tsx` — `"use client"` wrapper with `SessionProvider` from next-auth
* Created `src/app/offline-wrapper.tsx` — connects `useOfflineSync` hook → `OfflineIndicator` component
* Created `src/app/mobile-nav-wrapper.tsx` — `"use client"` wrapper for `MobileNav` (hidden on md+)
* Replaced `src/app/layout.tsx` — Root layout with Minitik metadata, Geist fonts, desktop `SidebarNav`, mobile `MobileNav`, `Providers`, `OfflineWrapper`
* Created `src/app/login/page.tsx` — Email/password form using `signIn("credentials")`, handles `callbackUrl` and error params
* Replaced `src/app/page.tsx` — Dashboard with welcome message, stats cards (fetches `/api/content` and `/api/scheduling`), quick action links
* Created `src/app/content/page.tsx` — Wraps existing `ContentLibrary` component
* Created `src/app/upload/page.tsx` — `UploadZone` + `UploadQueue` with local chunked upload state machine
* Created `src/app/schedule/page.tsx` — Schedule form + `JobStatusList`, fetches existing jobs from `/api/scheduling`
* Created `src/app/analytics/page.tsx` — Wraps existing `AnalyticsDashboard` component
* Created `src/app/accounts/page.tsx` — Fetches accounts from `/api/accounts`, passes to `AccountConnection` with Date conversion
* Extended `src/app/globals.css` — Added `pb-safe` utility (iOS safe area), thin scrollbar styles for desktop
* Created `src/app/manifest.ts` — Next.js metadata manifest porting existing `manifest.json` (fixed `"any maskable"` → `"maskable"` for TS types)
* Created `src/app/api/accounts/initiate/route.ts` — Missing route that `AccountConnection` component calls for OAuth PKCE flow
* Created `src/app/api/scheduling/jobs/[id]/route.ts` — Proxy route so `JobStatus` component's `/api/scheduling/jobs/${id}` calls reach the handler at `/api/scheduling/[id]`

## 3. The "Pain" Log (CRITICAL)
* **Tried:** Using `"any maskable"` for icon purpose in `manifest.ts` (matching original `manifest.json`)
* **Failed:** TS2820 — Next.js `MetadataRoute.Manifest` type only allows `"any" | "maskable" | "monochrome" | undefined`
* **Workaround:** Changed to `"maskable"` which is valid for the purpose field
* *Note:* The original static `manifest.json` in `src/apps/web/app/` still has `"any maskable"` — that file is not served by the app router.

## 4. Active Variable State
* No environment variables changed
* Next.js 16.1.6 shows deprecation warning: `"middleware"` file convention deprecated, suggests `"proxy"` — middleware still works, just a warning
* Build output confirms `ƒ Proxy (Middleware)` section exists

## 5. Immediate Next Steps
1. [ ] Commit all changes (15 new/modified files)
2. [ ] Verify login flow end-to-end (requires `NEXTAUTH_SECRET` and database seeded with a user)
3. [ ] Consider migrating `middleware.ts` to the new `proxy` convention when upgrading Next.js
4. [ ] Add the scheduling route at `/api/scheduling/route.ts` for GET (list jobs) — currently the schedule page fetches `/api/scheduling` for job list but that route's GET handler maps to `listJobsHandler` which needs to be verified
5. [ ] Test PWA install flow on mobile (manifest, icons, screenshots)
