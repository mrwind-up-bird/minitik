# Letter to Myself (Session Handoff)

**Date:** 2026-02-24

## 1. Executive Summary
* **Goal:** Add global footer with nyxCore copyright across all pages (including login), fix magic link auth flow.
* **Current Status:** Footer added to root layout. Magic link fixes deployed (server config, error handling, redirect flow). Committed and pushed.

## 2. The "Done" List (Context Anchor)
* Added global `<footer>` to `src/app/layout.tsx` — "(c) 2026 built by nyxCore" with link to https://nyxcore.vercel.app/
* Fixed magic link auth: added `server` property to EmailProvider, error handling in sendVerificationRequest, switched login page to redirect flow
* Added `postinstall: "prisma generate"` to package.json to fix Vercel build cache issue with stale Prisma client

## 3. The "Pain" Log (CRITICAL)
* **Tried:** `signIn("email", { redirect: false })` for magic link
* **Failed:** Redirected to `/api/auth/error` instead of returning response — `redirect: false` unreliable with NextAuth v4 Email provider
* **Workaround:** Use standard redirect flow: `signIn("email", { email, callbackUrl: "/" })` — NextAuth handles redirects to `/login?verify=1` or `/login?error=EmailSignin`
* **Tried:** EmailProvider without `server` property
* **Failed:** NextAuth v4 requires `server` even with custom `sendVerificationRequest`
* **Workaround:** Added `server: process.env.EMAIL_SERVER ?? "smtp://localhost"` (dummy value, unused since we override sendVerificationRequest)

## 4. Active Variable State
* `RESEND_API_KEY` set on Vercel production
* Default sender: `onboarding@resend.dev` — only delivers to Resend account owner's email
* To send to any email: verify domain in Resend, then set `EMAIL_FROM` env var

## 5. Immediate Next Steps
1. [ ] Test magic link flow end-to-end on production
2. [ ] Verify footer appears on all pages including login
3. [ ] Verify a custom domain in Resend for unrestricted email delivery
